<div class="voice-search-container">
  <!-- Bouton principal -->
  <button
    class="voice-button"
    [class.listening]="state.isListening"
    [class.speaking]="state.isSpeaking"
    [class.processing]="state.isProcessing"
    [class.disabled]="!state.isSupported"
    [class.mini]="mini()"
    [disabled]="!state.isSupported || state.isProcessing"
    (click)="onVoiceButtonClick()"
    [attr.aria-label]="getAriaLabel()">
    <!-- Icône microphone -->
    @if (!state.isListening && !state.isSpeaking) {
      <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
        <path
          d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
      </svg>
    }

    <!-- Animation d'écoute -->
    @if (state.isListening) {
      <div class="listening-animation">
        <span class="wave"></span>
        <span class="wave"></span>
        <span class="wave"></span>
      </div>
    }

    <!-- Icône haut-parleur (lecture) -->
    @if (state.isSpeaking) {
      <svg class="icon speaking-icon" viewBox="0 0 24 24" fill="currentColor">
        <path
          d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
      </svg>
    }

    <!-- Spinner de traitement -->
    @if (state.isProcessing) {
      <div class="spinner"></div>
    }
  </button>

  <!-- Indicateur de statut -->
  @if (showStatus()) {
    <div class="status-indicator">
      @if (state.isListening) {
        <span class="status listening"> Je vous écoute... </span>
      }
      @if (state.isSpeaking) {
        <span class="status speaking"> Lecture en cours... </span>
      }
      @if (state.isProcessing) {
        <span class="status processing"> Recherche en cours... </span>
      }
    </div>
  }

  <!-- Transcription en temps réel -->
  @if (showTranscript() && transcript) {
    <div class="transcript-container">
      <p class="transcript">{{ transcript }}</p>
    </div>
  }

  <!-- Message d'erreur -->
  @if (errorMessage) {
    <div class="error-container">
      <p class="error">{{ errorMessage }}</p>
      <button class="dismiss-btn" (click)="dismissError()">x</button>
    </div>
  }

  <!-- Bouton stop lecture -->
  @if (state.isSpeaking && showStopButton()) {
    <button class="stop-button" (click)="stopSpeaking()" aria-label="Arrêter la lecture">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M6 6h12v12H6z" />
      </svg>
    </button>
  }
</div>
